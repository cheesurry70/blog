#!/usr/bin/env node

require('shelljs/make')
require("colors")

config.silent = false
config.fatal = true

var Site = require('../../ingen/lib/site')

target.build = function() {
  echo('### building site...'.grey)
  var site = new Site()
  site.build()
}

target.preview = function() {
  echo('### previewing site on port 4000')
  var site = new Site({env: 'development', includeDrafts:true})
  site.serve()
}

target.deploy = function() {

  target.build()

  rm('-rf', '_tmp')
  mkdir('_tmp')
  cd('_tmp')

  echo('>>> Updating gh-pages branch'.grey)
  exec('git init')
  exec('git remote add origin git@github.com:philipwalton/blog.git')
  exec('git pull origin gh-pages')
  rm('-rf', './*')
  cp('-Rf', '../_site/', './')
  exec('git add -A')
  exec('git commit -m "Deploy site."')
  exec('git branch -m gh-pages')
  exec('git push origin gh-pages')
  cd('..')

  echo(">>> Cleaning up".grey)
  rm('-rf', '_site')
  rm('-rf', '_tmp')

  echo("*** Successfully deployed site!".green)
}
